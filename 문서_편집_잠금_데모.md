# 문서 편집 잠금 시스템 데모

## 시스템 개요

이 문서는 이랑위키에 새로 추가된 문서 편집 잠금 시스템을 설명하고 시연합니다. 이 기능은 여러 사용자가 동시에 같은 문서를 편집할 때 발생할 수 있는 충돌을 방지합니다.

## 작동 원리

### 1. 편집 잠금 획득
- 사용자가 문서 편집을 시작하면 시스템이 자동으로 해당 문서에 편집 잠금을 적용합니다.
- 잠금 정보는 데이터베이스에 저장되며, 다음 정보를 포함합니다:
  - 잠금 상태 (isLocked)
  - 잠금 소유자 (lockedBy)
  - 잠금 시작 시간 (lockStartTime)
  - 잠금 만료 시간 (lockExpiry) - 10분 후 자동 해제

### 2. 편집 잠금 확인
- 다른 사용자가 동일한 문서를 열면 시스템이 잠금 상태를 확인합니다.
- 잠금이 적용된 경우, 빨간색 경고 메시지를 표시합니다:
  > "이 문서는 {username}님이 편집 중입니다."

### 3. 편집 잠금 갱신
- 문서를 편집 중인 사용자가 저장을 시도할 때마다 잠금 시간이 연장됩니다.
- 이는 사용자가 문서를 계속 편집 중임을 나타냅니다.

### 4. 편집 잠금 해제
- 사용자가 문서 편집을 완료하고 저장하거나 페이지를 나가면 잠금이 즉시 해제됩니다.
- 또한, 잠금이 10분 이상 유지되면 자동으로 해제됩니다.

## 시연 시나리오

### 시나리오 1: 사용자 A가 문서 편집 중
1. 사용자 A가 "문서_편집_잠금_데모" 문서를 편집하기 시작
2. 시스템이 자동으로 문서에 편집 잠금을 적용
3. 사용자 A는 정상적으로 문서를 편집할 수 있음

### 시나리오 2: 사용자 B가 같은 문서 접근
1. 사용자 B가 "문서_편집_잠금_데모" 문서를 열려고 시도
2. 시스템이 잠금 상태를 확인하고 사용자 A가 편집 중임을 감지
3. 사용자 B에게 다음과 같은 빨간색 경고 메시지가 표시됨:
   > "이 문서는 사용자A님이 편집 중입니다."
4. 사용자 B는 문서를 열람할 수는 있지만 편집할 수 없음

### 시나리오 3: 자동 잠금 해제
1. 사용자 A가 10분 동안 아무 작업도 하지 않음
2. 시스템이 자동으로 편집 잠금을 해제
3. 이제 다른 사용자도 해당 문서를 편집할 수 있음

## 기술 구현

### 데이터베이스 스키마
문서 편집 잠금을 위해 WikiPage 스키마에 다음 필드가 추가되었습니다:
```javascript
editLock: {
  isLocked: { type: Boolean, default: false },
  lockedBy: { type: String }, // 편집 중인 사용자명
  lockedById: { type: mongoose.Schema.Types.ObjectId, ref: 'WikiUser' },
  lockStartTime: { type: Date },
  lockExpiry: { type: Date }, // 자동 해제 시간 (10분 후)
  lockReason: { type: String, default: 'editing' }
}
```

### API 엔드포인트
문서 편집 잠금 관리를 위한 새로운 API 엔드포인트가 추가되었습니다:
- `GET /api/wiki/pages/lock?title={title}` - 문서 잠금 상태 확인
- `POST /api/wiki/pages/lock` - 문서 편집 잠금 획득
- `PUT /api/wiki/pages/lock` - 문서 편집 잠금 갱신
- `DELETE /api/wiki/pages/lock?title={title}` - 문서 편집 잠금 해제

### 프론트엔드 구현
WikiEditor 컴포넌트에 다음 기능이 추가되었습니다:
- 문서 열기 시 잠금 상태 자동 확인
- 편집 시작 시 잠금 획득 시도
- 주기적으로 (30초마다) 잠금 상태 확인
- 저장 시 잠금 갱신
- 페이지 나가기 시 잠금 해제

## 이점

1. **데이터 무결성 보장**: 여러 사용자의 동시 편집으로 인한 충돌 방지
2. **사용자 경험 향상**: 다른 사용자가 편집 중임을 명확히 알 수 있음
3. **자동 관리**: 잠금이 일정 시간 후 자동으로 해제되어 시스템이 멈추는 것을 방지

## 주의사항

1. 편집 잠금은 10분 후 자동으로 해제되지만, 사용자가 페이지를 나가면 즉시 해제됩니다.
2. 관리자는 다른 사용자의 편집 잠금을 해제할 권한이 있습니다.
3. 편집 잠금 메시지는 현재 사용자가 아닌 다른 사용자가 편집 중일 때만 표시됩니다.

---

*이 문서는 문서 편집 잠금 시스템의 작동 방식을 설명하기 위해 작성되었습니다. 실제 시스템에서는 위키 관리자가 설정한 규칙에 따라 작동할 수 있습니다.*